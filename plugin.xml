<?xml version="1.0" encoding="UTF-8"?>
<plugin xmlns="http://www.phonegap.com/ns/plugins/1.0"
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:amazon="http://schemas.android.com/apk/lib/com.amazon.device.ads"
    xmlns:rim="http://www.blackberry.com/ns/widgets"
    id="com.donler.plugin.easemob"
    version="0.0.1">

  <name>Donler Easemob</name>
    <author>donler</author>

    <description>
        com.donler.plugins.easemob
    </description>

    <license>MIT</license>

    <js-module src="www/easemob.js" name="easemob">
        <clobbers target="easemob" />
    </js-module>

    <engines>
        <engine name="cordova" version=">=3.0.0" />
    </engines>

    <!-- android -->
    <platform name="android">
        <preference name="API_KEY" />
        <config-file target="res/xml/config.xml" parent="/*">
            <feature name="Easemob" >
                <param name="android-package" value="com.donler.plugin.easemob.Easemob"/>
            </feature>
        </config-file>

        <config-file target="AndroidManifest.xml" parent="/manifest">
            <uses-permission android:name="android.permission.VIBRATE" />
            <uses-permission android:name="android.permission.INTERNET" />
            <uses-permission android:name="android.permission.RECORD_AUDIO" />
            <uses-permission android:name="android.permission.CAMERA" />
            <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
            <!-- <uses-permission android:name="android.permission.ACCESS_MOCK_LOCATION" /> -->
            <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.MOUNT_UNMOUNT_FILESYSTEMS" />
            <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
            <uses-permission android:name="android.permission.GET_TASKS" />
            <uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
            <uses-permission android:name="android.permission.CHANGE_WIFI_STATE" />
            <uses-permission android:name="android.permission.WAKE_LOCK" />
            <uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" />
            <uses-permission android:name="android.permission.READ_PHONE_STATE" />
            <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
            <uses-permission android:name="android.permission.GET_ACCOUNTS" />
            <uses-permission android:name="android.permission.USE_CREDENTIALS" />
            <uses-permission android:name="android.permission.MANAGE_ACCOUNTS" />
            <uses-permission android:name="android.permission.AUTHENTICATE_ACCOUNTS" />
            <uses-permission android:name="com.android.launcher.permission.READ_SETTINGS" />
            <uses-permission android:name="android.permission.BROADCAST_STICKY" />
            <uses-permission android:name="android.permission.WRITE_SETTINGS" />
        </config-file>

        <config-file target="AndroidManifest.xml" parent="/manifest/application">
            <receiver android:name="com.easemob.chat.StartServiceReceiver" >
                <intent-filter android:priority="1000" >
                    <action android:name="android.intent.action.BOOT_COMPLETED" />
                    <action android:name="android.intent.action.QUICKBOOT_POWERON" />

                    <category android:name="android.intent.category.LAUNCHER" />
                </intent-filter>
            </receiver>
            <!-- 设置环信应用的appkey -->
            <meta-data
                android:name="EASEMOB_APPKEY"
                android:value="$API_KEY" />
            <!-- 声明sdk所需的service -->
            <service android:name="com.easemob.chat.EMChatService" />
        </config-file>
        <source-file src="src/android/HXNotifier.java" target-dir="src/com/donler/plugin/easemob" />
        <source-file src="src/android/Easemob.java" target-dir="src/com/donler/plugin/easemob" />
        <source-file src="src/android/libs/armeabi/libeasemob_jni.so" target-dir="libs/armeabi" />
        <source-file src="src/android/libs/armeabi/libeasemobservice.so" target-dir="libs/armeabi" />
        <source-file src="src/android/libs/x86/libeasemobservice.so" target-dir="libs/x86" />
        <source-file src="src/android/libs/x86_64/libeasemobservice.so" target-dir="libs/x86_64" />
        <source-file src="src/android/libs/easemobchat_2.1.9.jar" target-dir="libs" />
        <source-file src="src/android/libs/android-support-v4.jar" target-dir="libs" />
    </platform>

    <!-- amazon-fireos -->
    <platform name="amazon-fireos">

        <config-file target="res/xml/config.xml" parent="/*">
            <feature name="PushPlugin" >
                <param name="android-package" value="com.amazon.cordova.plugin.PushPlugin"/>
            </feature>
            <preference name="showmessageinnotification" value="true" />
            <preference name="defaultnotificationmessage" value="You have a new message." />
        </config-file>

        <config-file target="AndroidManifest.xml" parent="/manifest">
            <!-- This permission ensures that no other application can intercept your ADM messages. "[YOUR PACKAGE NAME]" is your package name as defined in your <manifest> tag. -->
            <permission android:name="$PACKAGE_NAME.permission.RECEIVE_ADM_MESSAGE" android:protectionLevel="signature" />
            <uses-permission android:name="$PACKAGE_NAME.permission.RECEIVE_ADM_MESSAGE" />
            <!-- This permission allows your app access to receive push notifications from ADM. -->
            <uses-permission android:name="com.amazon.device.messaging.permission.RECEIVE" />
            <!-- ADM uses WAKE_LOCK to keep the processor from sleeping when a message is received. -->
            <uses-permission android:name="android.permission.WAKE_LOCK" />
        </config-file>

        <config-file target="AndroidManifest.xml" parent="/manifest/application">
            <!-- You must explicitly enable ADM and declare whether your app cannot work without ADM (android:required="true") or can work without ADM (android:required="false").
            If you specify android:required="false", your app must degrade gracefully if ADM
            is unavailable. -->
            <amazon:enable-feature android:name="com.amazon.device.messaging" android:required="true"/>
            <service android:exported="false" android:name="com.amazon.cordova.plugin.ADMMessageHandler" />
            <activity android:exported="true" android:name="com.amazon.cordova.plugin.ADMHandlerActivity" />
            <receiver android:name="com.amazon.cordova.plugin.ADMMessageHandler$Receiver" android:permission="com.amazon.device.messaging.permission.SEND">
                <intent-filter>
                    <action android:name="com.amazon.device.messaging.intent.REGISTRATION" />
                    <action android:name="com.amazon.device.messaging.intent.RECEIVE" />
                    <category android:name="$PACKAGE_NAME" />
                </intent-filter>
            </receiver>
        </config-file>

        <source-file src="src/amazon/PushPlugin.java" target-dir="src/com/amazon/cordova/plugin" />
        <source-file src="src/amazon/ADMMessageHandler.java" target-dir="src/com/amazon/cordova/plugin" />
        <source-file src="src/amazon/ADMHandlerActivity.java" target-dir="src/com/amazon/cordova/plugin" />

    </platform>

    <!-- ios -->
    <platform name="ios">

        <config-file target="config.xml" parent="/*">
            <feature name="easemob">
                <param name="ios-package" value="easemob"/>
            </feature>
        </config-file>

        <framework src="MobileCoreServices.framework"/>
        <framework src="CFNetwork.framework"/>
        <framework src="libsqlite3.dylib" />
        <framework src="libstdc++.6.0.9.dylib" />
        <framework src="libz.dylib" />
        <framework src="libiconv.dylib" />
        <framework src="libresolv.dylib" />
        <framework src="libxml2.dylib" />
        <source-file src="src/ios/relative/libEaseMobClientSDKLite.a" framework="true" />

        <header-file src="src/ios/easemob.h" />
        <source-file src="src/ios/easemob.m" />

    </platform>

    <!-- blackberry10 -->
    <platform name="blackberry10">
        <dependency id="com.blackberry.push" />
        <dependency id="com.blackberry.invoked" />
        <config-file target="www/config.xml" parent="/widget">
            <feature name="PushPlugin" value="PushPlugin" />
        </config-file>
        <js-module src="www/blackberry10/PushPluginProxy.js" name="PushPluginProxy" >
            <runs />
        </js-module>
    </platform>

    <!-- wp8 -->
    <platform name="wp8">

    <config-file target="config.xml" parent="/*">
      <feature name="PushPlugin">
        <param name="wp-package" value="PushPlugin"/>
      </feature>
    </config-file>

    <config-file target="Properties/WMAppManifest.xml" parent="/Deployment/App/Capabilities">
      <Capability Name="ID_CAP_PUSH_NOTIFICATION"/>
    </config-file>

    <source-file src="src/wp8/PushPlugin.cs" />
    <framework src="src/wp8/Newtonsoft.Json.dll" custom="true" />

  </platform>

  <!-- windows8 -->
  <platform name="windows8">
    <js-module src="src/windows8/PushPluginProxy.js" name="PushPlugin">
      <merges target="" />
    </js-module>
  </platform>

</plugin>
